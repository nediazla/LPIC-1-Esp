# 5. Fundamentos de redes

## 5.1 Conocimientos básicos de los protocolos de internet

### Modelo TCP/IP

Capas:
```
1. Acceso a la red     (Ethernet, WiFi)
2. Internet            (IP)
3. Transporte          (TCP, UDP)
4. Aplicación          (HTTP, DNS, SSH, SMTP)
```

### Protocolos principales

#### IP (Internet Protocol)
Protocolo sin conexión y no confiable.
Versiones:
```
IPv4: 32 bits (0.0.0.0 a 255.255.255.255)
IPv6: 128 bits
```

Ver configuración IP del sistema:
```
ip a
ip -4 a
ip -6 a
```

#### TCP (Transmission Control Protocol)
Confiable, orientado a conexión.
Características:
- Establece sesión (3-way handshake)
- Reenvío de paquetes perdidos
- Control de congestión

#### UDP (User Datagram Protocol)
No confiable, sin conexión.
Usado en:
- DNS
- VoIP
- Streaming

#### ICMP (Internet Control Message Protocol)
Mensajes de control:
```
ping
traceroute
```

### Puertos comunes

```
22   SSH
53   DNS
80   HTTP
443  HTTPS
25   SMTP
110  POP3
143  IMAP
3306 MySQL
```

### Comandos útiles para ver puertos
```
ss -tulnp
netstat -tulnp   # si está instalado
```

---

## 5.2 Configuración básica de red

### Ver interfaces de red
```
ip link
ip a
```

Traer interfaz arriba/abajo:
```
ip link set eth0 up
ip link set eth0 down
```

### Configurar IP temporal
(Se pierde tras reinicio)
```
ip addr add 192.168.1.50/24 dev eth0
ip route add default via 192.168.1.1
```

Eliminar IP temporal:
```
ip addr del 192.168.1.50/24 dev eth0
```

### Configuración permanente en Ubuntu (Netplan)

Archivo en:
```
/etc/netplan/*.yaml
```

Ejemplo DHCP:
```
network:
  version: 2
  ethernets:
    ens33:
      dhcp4: true
```

Ejemplo IP estática:
```
network:
  version: 2
  ethernets:
    ens33:
      addresses: [192.168.1.50/24]
      gateway4: 192.168.1.1
      nameservers:
        addresses: [8.8.8.8, 1.1.1.1]
```

Aplicar cambios:
```
netplan apply
```

### Ver tabla de rutas
```
ip route
```

Agregar ruta:
```
ip route add 10.10.10.0/24 via 192.168.1.1
```

---

## 5.3 Detección de problemas de red

### Comandos de diagnóstico

Ver conectividad:
```
ping 8.8.8.8
ping -c 4 google.com
```

Ver ruta al destino:
```
traceroute google.com
```

(DNS puede usar traceroute -n para evitar resolución)
```
traceroute -n 8.8.8.8
```

Comprobar DNS:
```
dig google.com
host google.com
nslookup google.com
```

Ver tabla ARP:
```
ip neigh
```

Ver interfaces y estados:
```
ip link
```

Ver sockets y puertos:
```
ss -tulnp
```

Sniffing básico (si instalado):
```
tcpdump -i eth0
tcpdump -n host 8.8.8.8
```

### Diagnóstico de red local

Ver gateway:
```
ip route | grep default
```

Ver resolución DNS:
```
cat /etc/resolv.conf
```

Comprobar si interfaz recibe IP:
```
dhclient -v interfaz
```

Ver logs de red:
```
journalctl -u NetworkManager
journalctl -u systemd-networkd
```

---

## 5.4 Configuración de un cliente DNS

El cliente DNS indica qué servidores DNS usar y cómo consultar.

### Ver servidor DNS actual
```
systemd-resolve --status
resolvectl status
```

### Archivo resolv.conf
En sistemas modernos apunta a systemd-resolved:
```
/etc/resolv.conf -> /run/systemd/resolve/stub-resolv.conf
```

Para ver su contenido:
```
cat /etc/resolv.conf
```

### Configurar DNS permanentemente (Netplan)

Ejemplo:
```
network:
  version: 2
  ethernets:
    ens33:
      addresses: [192.168.1.100/24]
      gateway4: 192.168.1.1
      nameservers:
        addresses: [1.1.1.1, 8.8.8.8]
```

Aplicar:
```
netplan apply
```

### Configurar DNS temporalmente
```
resolvectl dns eth0 8.8.8.8 1.1.1.1
resolvectl domain eth0 example.com
```

### Limpiar caché DNS
```
resolvectl flush-caches
```

Ver estadísticas:
```
resolvectl statistics
```

### Probar cliente DNS
```
dig @8.8.8.8 google.com
host google.com 1.1.1.1
nslookup debian.org
```


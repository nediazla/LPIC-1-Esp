# 1. Shells y Shell Scripting

## 1.1 Personalización y uso del intérprete de comandos

El intérprete de comandos más común en Linux es **bash**, aunque también se usan sh, zsh, ksh y otros.

### Ver qué shell usa un usuario
```
echo $SHELL
grep usuario /etc/passwd
```

### Ver variables de entorno y variables del shell
Variables de entorno (exportadas):
```
printenv
echo $PATH
export VAR=value
```

Variables locales (solo en la shell actual):
```
VAR=value
echo $VAR
```

Ver todas las variables:
```
set
```

### Archivos de configuración del shell (bash)
Al iniciar sesión (login shell):
```
/etc/profile
~/.bash_profile
~/.bash_login
~/.profile
```

En shells no interactivos o subshells:
```
~/.bashrc
```

Cargar un archivo manualmente:
```
source ~/.bashrc
. ~/.bashrc
```

### Personalizar el prompt (PS1)
Ejemplo:
```
PS1="\u@\h:\w$ "
```

Variables útiles:
```
\u   usuario
\h   hostname
\w   directorio actual
```

Hacer permanente:
```
echo 'PS1="\u@\h:\w$ "' >> ~/.bashrc
```

### Alias
Crear alias:
```
alias ll='ls -l'
alias la='ls -la'
```

Eliminar alias temporalmente:
```
unalias ll
```

Alias permanentes → agregar a `~/.bashrc`.

### Historial del shell
```
history
!55
!!          # último comando
```

Archivo del historial:
```
~/.bash_history
```

Control del historial:
```
HISTSIZE=2000
HISTFILESIZE=5000
```

---

## 1.2 Personalización y creación de scripts simples

Un script es un archivo de texto con comandos ejecutados por un intérprete (bash en LPIC-1).

### Crear un script básico
```
nano mi_script.sh
```

Contenido:
```
#!/bin/bash
echo "Hola mundo"
```

Hacerlo ejecutable:
```
chmod +x mi_script.sh
```

Ejecutarlo:
```
./mi_script.sh
bash mi_script.sh
```

### Variables dentro de un script
```
#!/bin/bash
nombre="Nelson"
echo "Hola $nombre"
```

Variables de entorno:
```
export VAR=value
```

### Leer datos del usuario
```
#!/bin/bash
echo "Ingresa tu nombre:"
read nombre
echo "Hola $nombre"
```

### Argumentos recibidos en la línea de comandos
```
$ ./script.sh arg1 arg2
```

Dentro del script:
```
$0   # nombre del script
$1   # primer argumento
$2   # segundo argumento
$#   # cantidad de argumentos
$@   # todos los argumentos
```

Ejemplo:
```
#!/bin/bash
echo "Primer argumento: $1"
echo "Total argumentos: $#"
```

### Condicionales (if)
```
if [ -f archivo.txt ]; then
    echo "El archivo existe"
else
    echo "No existe"
fi
```

Comparaciones comunes:
```
-n "$var"    # no vacío
-z "$var"    # vacío
-e archivo   # existe
-d archivo   # directorio
```

### Bucles simples

For:
```
for i in 1 2 3 4 5; do
    echo "Número: $i"
done
```

While:
```
contador=1
while [ $contador -le 5 ]; do
    echo "Contador: $contador"
    contador=$((contador+1))
done
```

Until:
```
x=1
until [ $x -gt 5 ]; do
    echo $x
    x=$((x+1))
done
```

### Uso de funciones
```
mi_funcion() {
    echo "Hola desde la función"
}

mi_funcion
```

### Scripts con operaciones reales

Verificar si un servicio está activo:
```
#!/bin/bash
if systemctl is-active --quiet ssh; then
    echo "SSH está activo"
else
    echo "SSH no está activo"
fi
```

Verificar conectividad:
```
#!/bin/bash
ping -c 1 8.8.8.8 >/dev/null 2>&1

if [ $? -eq 0 ]; then
    echo "Conexión OK"
else
    echo "Sin conexión"
fi
```

Listar procesos con más consumo de CPU:
```
#!/bin/bash
ps aux --sort=-%cpu | head
```

Backup simple:
```
#!/bin/bash
fecha=$(date +"%Y%m%d")
tar -czf backup_$fecha.tar.gz /etc
```

### Ejecución programada con cron (relacionado)
Agregar al crontab:
```
crontab -e
```

Ejemplo para ejecutar diario:
```
0 2 * * * /ruta/script.sh
```

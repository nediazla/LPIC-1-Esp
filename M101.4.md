# 4. Dispositivos, Sistemas de Archivos de Linux y Jerarquía Estándar del Sistema de Ficheros (FHS)

## 4.1 Creación de particiones y sistemas de archivos

Listado de discos y particiones:
```
lsblk
lsblk -f
blkid
```

Herramientas para gestionar particiones:
```
fdisk /dev/sda       # MBR
gdisk /dev/sda       # GPT
parted /dev/sda
```

Crear particiones:
```
fdisk /dev/sda
n    # nueva partición
w    # guardar cambios
```

Crear sistemas de archivos:
```
mkfs.ext4 /dev/sda1
mkfs.xfs /dev/sdb1
mkfs.btrfs /dev/sdc1
```

Crear e iniciar swap:
```
mkswap /dev/sda2
swapon /dev/sda2
swapon --show
```

Comprobar integridad del FS creado:
```
fsck -f /dev/sda1
```

---

## 4.2 Mantenimiento de la integridad del sistema de archivos

Comando general de chequeo:
```
fsck /dev/sda1
```

Forzar chequeo:
```
fsck -f /dev/sda1
```

Programar chequeos automáticos con tune2fs:
```
tune2fs -c 30 /dev/sda1     # cada 30 montajes
tune2fs -i 2m /dev/sda1     # cada 2 meses
```

Ver información del FS:
```
dumpe2fs /dev/sda1
```

Ver errores registrados:
```
dmesg | grep -i "ext4"
journalctl -k | grep -i xfs
```

Montar en modo solo lectura si hay daños:
```
mount -o ro /dev/sda1 /mnt
```

---

## 4.3 Montaje y desmontaje de sistemas de archivos

Montajes manuales:
```
mount /dev/sda1 /mnt
mount -t ext4 /dev/sda2 /datos
```

Desmontar sistemas de archivos:
```
umount /mnt
umount /datos
```

Ver montajes activos:
```
mount
findmnt
cat /proc/mounts
```

Montaje permanente en /etc/fstab:
```
/dev/sda1   /datos   ext4   defaults   0 2
```

Montaje usando UUID:
```
UUID=xxxx-xxxx   /backup   ext4   defaults   0 2
```

Ver UUIDs:
```
blkid
```

Montaje automático de swap en fstab:
```
UUID=xxxx-xxxx   none   swap   sw   0 0
```

Releer fstab sin reiniciar:
```
mount -a
```

---

## 4.4 Gestión de permisos y propiedad de archivos

Representación de permisos:
```
r = lectura
w = escritura
x = ejecución
```

Permisos en formato octal:
```
chmod 755 archivo
chmod 644 archivo
```

Permisos simbólicos:
```
chmod u+rwx archivo
chmod g-w archivo
chmod o-r archivo
chmod u=rw, g=r, o= archivo
```

Cambiar propiedad:
```
chown usuario archivo
chown usuario:grupo archivo
```

Cambiar grupo:
```
chgrp grupo archivo
```

Máscara de creación de archivos (umask):
```
umask
umask 022
```

Ver permisos en detalle:
```
stat archivo
```

Atributos extendidos (chattr/lsattr):
```
chattr +i archivo     # inmutable
chattr +a archivo     # append-only
lsattr archivo
```

---

## 4.5 Creación y modificación de enlaces simbólicos y duros

Enlaces duros (misma inode):
```
ln origen hardlink
```

Enlaces simbólicos (soft links):
```
ln -s /ruta/original enlace
```

Ver inodes:
```
ls -li
```

Diferencias clave:
- Hardlink → apunta al mismo inode, solo en el mismo filesystem.
- Symlink → archivo especial que apunta a una ruta, puede cruzar discos.

Eliminar enlaces:
```
rm enlace
```

Actualizar symlink roto:
```
ln -sf nuevo_destino enlace
```

---

## 4.6 Búsqueda de ficheros del sistema y colocación en su correcta localización

Buscar archivos:
```
find /ruta -name "*.conf"
find / -type f -size +10M
find /var/log -mtime -1
```

Buscar por contenido:
```
grep -R "cadena" /etc
grep -n "root" /etc/passwd
```

Uso de locate:
```
updatedb
locate sshd_config
```

Jerarquía estándar del sistema de archivos (FHS):

Rutas principales:
```
/bin       # binarios esenciales
/sbin      # binarios de administración
/lib       # librerías esenciales
/etc       # configuración
/home      # usuarios
/root      # home de root
/var       # logs, cache, spools
/usr       # programas, librerías y documentación
/usr/bin   # binarios no esenciales
/usr/sbin  # herramientas admins
/tmp       # temporales
```

Ubicación correcta de componentes:
- Configuración → `/etc`
- Logs → `/var/log`
- Binarios → `/usr/bin` o `/bin`
- Bibliotecas → `/usr/lib` o `/lib`
- Archivos estáticos web → `/var/www`
- Archivos temporales → `/tmp`

Buscar dónde está un comando:
```
which nginx
whereis sshd
type ls
```

Identificar qué paquete instaló un fichero:
```
dpkg -S /ruta/archivo         # Debian/Ubuntu
rpm -qf /ruta/archivo         # RPM
```
